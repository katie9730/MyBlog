##### 1.为什么要用Token
+ 1.Token完全由应用管理，可以避免同源策略
+ 2.Token避免CSRF攻击
+ 3.Token可以是无状态的，可在多个服务间共享

Token由服务端产生。当前端使用用户名/密码向服务端请求认证，服务端认证成功后，则返回Token给前端。前端每次请求带上Token证明自己合法。若此Token被存入数据库，那么他就是一个永久的身份令牌。

##### 2.那么Token需要设置有效期么？
从吊销角度还是安全角度，Token都需要设置有效期。例如定期设置密码，以防泄露；例如SSL安全证书也有设置了有效期。    

那么就会存在Token过期失效，就需要解决在操作过程中不能让用户感到Token失效这个问题
+ 方案一：服务端保存Token状态，用户每次操作，会自动刷新Token的过期时间，例如Session就是采用这种策略的。弊端：在前后端分离，单页APP情况下就不太适用。 + 方案二：使用Refresh Token，避免频繁读写操作。无需刷新过期时间，一旦过期，则反馈给前端。前端再开始重新申请。

**2.1 时序图表示**
1. 登录
![avatar](http://image109.360doc.com/DownloadImg/2018/02/2311/125319448_1_20180223112951336)

2. 业务请求
![avatar](http://image109.360doc.com/DownloadImg/2018/02/2311/125319448_2_20180223112951446)

3.Token过期，刷新Token
![avatar](http://image109.360doc.com/DownloadImg/2018/02/2311/125319448_3_20180223112951508)

**2.2 无状态Token**
+ Refresh Token有效时间较长，所以它应该在服务器端有状态，为增强安全性，确保用户注销时可控。
+ 可考虑使用二次认证来增强敏感操作的安全性。

**2.3 分离认证服务**
当Token无状态之后，单点登录会变得容易。前端可拿到一个有效Token，则可通过认证。

**2.4 不受信的业务服务器**
遇到不受信的业务服务器时，则可通过使用不同的密钥。认证服务器使用密钥1签发，业务服务器使用密钥2验证，此方法就是典型非对称加密签名的应用场景。（认证服务器使用私钥对Token签名，公开公钥。信任这个认证服务器的业务服务器保存公钥，用于验证签名），弊端：多个业务服务器之间使用相同的Token对用户来说并不安全。     
为了防止这种情况发生，就需要在认证服务器产生 Token 的时候，把使用该 Token 的业务服务器的信息记录在 Token 中，这样当另一个业务服务器拿到这个 Token 的时候，发现它并不是自己应该验证的 Token，就可以直接拒绝。